<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="æºç è§£æ," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="tipsï¼šHashMapæ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰çš„ç»“åˆä½“ã€‚ï¼ˆæ’å…¥é“¾è¡¨çš„æ—¶å€™æ˜¯å¤´æ’æ³•ã€‚ï¼‰

HashMap æ¦‚è¿°HashMap æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„ Map æ¥å£çš„éåŒæ­¥å®ç°ã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶å…è®¸ä½¿ç”¨ null å€¼å’Œ null é”®ã€‚æ­¤ç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼Œç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚
æ­¤å®ç°å‡å®šå“ˆå¸Œå‡½æ•°å°†å…ƒç´ é€‚å½“åœ°åˆ†å¸ƒåœ¨å„æ¡¶(æ¯ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºæ¡¶bucket)ä¹‹é—´ï¼Œå¯ä¸ºåŸºæœ¬æ“ä½œï¼ˆget å’Œ">
<meta property="og:type" content="article">
<meta property="og:title" content="Java HashMapæºç è§£æ">
<meta property="og:url" content="https://brandon-winterfell.github.io/2017/03/16/Java-HashMapæºç è§£æ/index.html">
<meta property="og:site_name" content="Brandon-Winterfell's Blog">
<meta property="og:description" content="tipsï¼šHashMapæ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰çš„ç»“åˆä½“ã€‚ï¼ˆæ’å…¥é“¾è¡¨çš„æ—¶å€™æ˜¯å¤´æ’æ³•ã€‚ï¼‰

HashMap æ¦‚è¿°HashMap æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„ Map æ¥å£çš„éåŒæ­¥å®ç°ã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶å…è®¸ä½¿ç”¨ null å€¼å’Œ null é”®ã€‚æ­¤ç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼Œç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚
æ­¤å®ç°å‡å®šå“ˆå¸Œå‡½æ•°å°†å…ƒç´ é€‚å½“åœ°åˆ†å¸ƒåœ¨å„æ¡¶(æ¯ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºæ¡¶bucket)ä¹‹é—´ï¼Œå¯ä¸ºåŸºæœ¬æ“ä½œï¼ˆget å’Œ">
<meta property="og:image" content="https://brandon-winterfell.github.io/images/hashmap1.jpg">
<meta property="og:image" content="https://brandon-winterfell.github.io/images/map_field_method.png">
<meta property="og:image" content="https://brandon-winterfell.github.io/images/hashtable.png">
<meta property="og:updated_time" content="2017-03-16T12:30:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java HashMapæºç è§£æ">
<meta name="twitter:description" content="tipsï¼šHashMapæ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰çš„ç»“åˆä½“ã€‚ï¼ˆæ’å…¥é“¾è¡¨çš„æ—¶å€™æ˜¯å¤´æ’æ³•ã€‚ï¼‰

HashMap æ¦‚è¿°HashMap æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„ Map æ¥å£çš„éåŒæ­¥å®ç°ã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶å…è®¸ä½¿ç”¨ null å€¼å’Œ null é”®ã€‚æ­¤ç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼Œç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚
æ­¤å®ç°å‡å®šå“ˆå¸Œå‡½æ•°å°†å…ƒç´ é€‚å½“åœ°åˆ†å¸ƒåœ¨å„æ¡¶(æ¯ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºæ¡¶bucket)ä¹‹é—´ï¼Œå¯ä¸ºåŸºæœ¬æ“ä½œï¼ˆget å’Œ">
<meta name="twitter:image" content="https://brandon-winterfell.github.io/images/hashmap1.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://brandon-winterfell.github.io/2017/03/16/Java-HashMapæºç è§£æ/"/>





  <title> Java HashMapæºç è§£æ | Brandon-Winterfell's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?314832464c94b95e6b76a5f064a517cb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Brandon-Winterfell's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle">é—²å¯‚å¤æ± æ—,é’è›™è·³è¿›æ°´ä¸­å¤®,æ‰‘é€šä¸€å£°å“</p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://brandon-winterfell.github.io/2017/03/16/Java-HashMapæºç è§£æ/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Brandon-Winterfell">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Brandon-Winterfell's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Brandon-Winterfell's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Java HashMapæºç è§£æ
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-16T15:45:29+08:00">
                2017-03-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/16/Java-HashMapæºç è§£æ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/16/Java-HashMapæºç è§£æ/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2017/03/16/Java-HashMapæºç è§£æ/" class="leancloud_visitors" data-flag-title="Java HashMapæºç è§£æ">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•° </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>tipsï¼šHashMapæ˜¯æ•°ç»„å’Œé“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰çš„ç»“åˆä½“ã€‚ï¼ˆæ’å…¥é“¾è¡¨çš„æ—¶å€™æ˜¯å¤´æ’æ³•ã€‚ï¼‰</p>
</blockquote>
<h3 id="HashMap-æ¦‚è¿°"><a href="#HashMap-æ¦‚è¿°" class="headerlink" title="HashMap æ¦‚è¿°"></a>HashMap æ¦‚è¿°</h3><p>HashMap æ˜¯åŸºäºå“ˆå¸Œè¡¨çš„ Map æ¥å£çš„éåŒæ­¥å®ç°ã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶å…è®¸ä½¿ç”¨ null å€¼å’Œ null é”®ã€‚æ­¤ç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼Œç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚</p>
<p>æ­¤å®ç°å‡å®šå“ˆå¸Œå‡½æ•°å°†å…ƒç´ é€‚å½“åœ°åˆ†å¸ƒåœ¨å„æ¡¶(æ¯ä¸ªåˆ—è¡¨è¢«ç§°ä¸ºæ¡¶bucket)ä¹‹é—´ï¼Œå¯ä¸ºåŸºæœ¬æ“ä½œï¼ˆget å’Œ putï¼‰æä¾›ç¨³å®šçš„æ€§èƒ½ã€‚è¿­ä»£ collection è§†å›¾æ‰€éœ€çš„æ—¶é—´ä¸ HashMap å®ä¾‹çš„â€œå®¹é‡â€ï¼ˆæ¡¶çš„æ•°é‡ï¼‰åŠå…¶å¤§å°ï¼ˆé”®-å€¼æ˜ å°„å…³ç³»æ•°ï¼‰æˆæ¯”ä¾‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¿­ä»£æ€§èƒ½å¾ˆé‡è¦ï¼Œåˆ™ä¸è¦å°†åˆå§‹å®¹é‡è®¾ç½®å¾—å¤ªé«˜æˆ–å°†åŠ è½½å› å­è®¾ç½®å¾—å¤ªä½ã€‚<a id="more"></a>ä¹Ÿè®¸å¤§å®¶å¼€å§‹å¯¹è¿™æ®µè¯æœ‰ä¸€ç‚¹ä¸å¤ªæ‡‚ï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œå½“ä½ è¯»å®Œè¿™ç¯‡æ–‡ç« åï¼Œå°±èƒ½æ·±åˆ‡ç†è§£è¿™å…¶ä¸­çš„å«ä¹‰äº†ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šHashmap ä¸æ˜¯åŒæ­¥çš„ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ª HashMapï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šï¼ˆæŒ‡æ·»åŠ æˆ–è€…åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ˜ å°„å…³ç³»çš„ä»»ä½•æ“ä½œï¼‰ä¿®æ”¹äº†ï¼Œåˆ™å¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ï¼Œä»¥é˜²æ­¢å¯¹æ˜ å°„è¿›è¡Œæ„å¤–çš„éåŒæ­¥è®¿é—®ã€‚</p>
<h3 id="HashMap-çš„æ•°æ®ç»“æ„"><a href="#HashMap-çš„æ•°æ®ç»“æ„" class="headerlink" title="HashMap çš„æ•°æ®ç»“æ„"></a>HashMap çš„æ•°æ®ç»“æ„</h3><p>åœ¨Javaç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæœ€åŸºæœ¬çš„æ•°æ®ç»“æ„å°±æ˜¯ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯æ•°ç»„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆï¼ˆå¼•ç”¨ï¼‰ï¼ŒHashMapå°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„å®ç°ã€‚<strong>HashMapå®é™…ä¸Šæ˜¯ä¸€ä¸ªâ€é“¾è¡¨æ•£åˆ—â€çš„æ•°æ®ç»“æ„ï¼Œå³æ•°ç»„å’Œé“¾è¡¨ï¼ˆå•å‘é“¾è¡¨ï¼‰çš„ç»“åˆä½“ã€‚</strong></p>
<p><img src="/images/hashmap1.jpg" alt="HashMapæ•°æ®ç»“æ„"></p>
<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<strong>HashMapåº•å±‚å°±æ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹åˆæ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ˆå•é“¾è¡¨ï¼‰</strong>ã€‚å½“æ–°å»ºä¸€ä¸ªHashMapçš„æ—¶å€™ï¼Œå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ã€‚</p>
<h3 id="HashMapçš„ä¸€äº›ç‰¹ç‚¹"><a href="#HashMapçš„ä¸€äº›ç‰¹ç‚¹" class="headerlink" title="HashMapçš„ä¸€äº›ç‰¹ç‚¹"></a>HashMapçš„ä¸€äº›ç‰¹ç‚¹</h3><ul>
<li>éçº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”å…è®¸keyä¸valueéƒ½ä¸ºnullå€¼ï¼ŒHashTableä¸ä¹‹ç›¸åï¼Œä¸ºçº¿ç¨‹å®‰å…¨ï¼Œkeyä¸valueéƒ½ä¸å…è®¸nullå€¼ã€‚</li>
<li>ä¸ä¿è¯å…¶å†…éƒ¨å…ƒç´ çš„é¡ºåºï¼Œè€Œä¸”éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒåŒä¸€å…ƒç´ çš„ä½ç½®ä¹Ÿå¯èƒ½æ”¹å˜ï¼ˆresizeæƒ…å†µä¸‹ï¼Œå…ƒç´ ä¼šæ ¹æ®æ–°çš„å“ˆå¸Œç é‡æ–°æ”¾ç½®ï¼‰</li>
<li>putã€getæ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚</li>
<li>éå†å…¶é›†åˆè§†è§’çš„æ—¶é—´å¤æ‚åº¦ä¸å…¶å®¹é‡ï¼ˆcapacityï¼Œæ§½çš„ä¸ªæ•°ï¼‰å’Œç°æœ‰å…ƒç´ çš„å¤§å°ï¼ˆentryçš„ä¸ªæ•°ï¼‰æˆæ­£æ¯”ï¼Œæ‰€ä»¥å¦‚æœéå†çš„æ€§èƒ½è¦æ±‚å¾ˆé«˜ï¼Œä¸è¦æŠŠcapactiyè®¾ç½®çš„è¿‡é«˜æˆ–æŠŠå¹³è¡¡å› å­ï¼ˆload factorï¼Œå½“entryæ•°å¤§äºcapacity*loadFactoræ—¶ï¼Œä¼šè¿›è¡Œresizeï¼Œresideä¼šå¯¼è‡´keyè¿›è¡Œrehashï¼‰è®¾ç½®çš„è¿‡ä½ã€‚</li>
<li>ç”±äºHashMapæ˜¯çº¿ç¨‹éå®‰å…¨çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯æ„å‘³ç€å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ä¸€hashmapçš„é›†åˆè¯•å›¾åšè¿­ä»£æ—¶æœ‰ç»“æ„çš„ä¸Šæ”¹å˜ï¼ˆæ·»åŠ ã€åˆ é™¤entryï¼Œåªæ”¹å˜entryçš„valueçš„å€¼ä¸ç®—ç»“æ„æ”¹å˜ï¼‰ï¼Œé‚£ä¹ˆä¼šæŠ¥<code>ConcurrentModificationException</code>ï¼Œä¸“ä¸šæœ¯è¯­å«fail-fastï¼Œå°½æ—©æŠ¥é”™å¯¹äºå¤šçº¿ç¨‹ç¨‹åºæ¥è¯´æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</li>
<li><code>Map m = Collections.synchronizedMap(new HashMap(...));</code> è¿™æ˜¯ä¸€ç§åŒ…è£…ç±»ã€‚ é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å¾—åˆ°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„mapã€‚</li>
</ul>
<h3 id="ç­¾åï¼ˆsignatureï¼‰"><a href="#ç­¾åï¼ˆsignatureï¼‰" class="headerlink" title="ç­¾åï¼ˆsignatureï¼‰"></a>ç­¾åï¼ˆsignatureï¼‰</h3><pre><code>public class HashMap&lt;K,V&gt;
       extends AbstractMap&lt;K,V&gt;
   implements Map&lt;K,V&gt;, Cloneable, Serializable
</code></pre><p>å¯ä»¥çœ‹åˆ° <code>HashMap</code> ç»§æ‰¿äº†</p>
<ul>
<li>æ ‡è®°æ¥å£ <code>Cloneable</code> ï¼Œç”¨äºè¡¨æ˜ <code>HashMap</code> å¯¹è±¡ä¼šé‡å†™ <code>java.lang.Object#clone()</code> æ–¹æ³•ï¼ŒHashMapå®ç°çš„æ˜¯æµ…æ‹·è´ï¼ˆshallow copyï¼‰ã€‚</li>
<li>æ ‡è®°æ¥å£ <code>Serializable</code> ï¼Œç”¨äºè¡¨æ˜ <code>HashMap</code> å¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–</li>
</ul>
<p>æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œ <code>HashMap</code> åŒæ—¶ç»§æ‰¿äº†æŠ½è±¡ç±» <code>AbstractMap</code> ä¸æ¥å£ <code>Map</code> ï¼Œå› ä¸ºæŠ½è±¡ç±» <code>AbstractMap</code> çš„ç­¾åä¸º</p>
<p><code>public abstract class AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;</code></p>
<p><a href="http://stackoverflow.com/questions/14062286/java-why-does-weakhashmap-implement-map-whereas-it-is-already-implemented-by-ab" target="_blank" rel="external">Stack Overfloooow</a>ä¸Šè§£é‡Šåˆ°ï¼š</p>
<blockquote>
<p>åœ¨è¯­æ³•å±‚é¢ç»§æ‰¿æ¥å£Mapæ˜¯å¤šä½™çš„ï¼Œè¿™ä¹ˆåšä»…ä»…æ˜¯ä¸ºäº†è®©é˜…è¯»ä»£ç çš„äººæ˜ç¡®çŸ¥é“HashMapæ˜¯å±äºMapä½“ç³»çš„ï¼Œèµ·åˆ°äº†æ–‡æ¡£çš„ä½œç”¨</p>
</blockquote>
<p><code>AbstractMap</code> ç›¸å½“äºä¸ªè¾…åŠ©ç±»ï¼Œ<code>Map</code> çš„ä¸€äº›æ“ä½œè¿™é‡Œé¢å·²ç»æä¾›äº†é»˜è®¤å®ç°ï¼Œåé¢å…·ä½“çš„å­ç±»å¦‚æœæ²¡æœ‰ç‰¹æ®Šè¡Œä¸ºï¼Œå¯ç›´æ¥ä½¿ç”¨ <code>AbstractMap</code> æä¾›çš„å®ç°ã€‚</p>
<h4 id="Cloneableæ¥å£"><a href="#Cloneableæ¥å£" class="headerlink" title="Cloneableæ¥å£"></a>Cloneableæ¥å£</h4><blockquote>
<p>Itâ€™s evil, donâ€™t use it.</p>
</blockquote>
<p><code>Cloneable</code>è¿™ä¸ªæ¥å£è®¾è®¡çš„éå¸¸ä¸å¥½ï¼Œæœ€è‡´å‘½çš„ä¸€ç‚¹æ˜¯å®ƒé‡Œé¢ç«Ÿç„¶æ²¡æœ‰cloneæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è‡ªå·±å†™çš„ç±»å®Œå…¨å¯ä»¥å®ç°è¿™ä¸ªæ¥å£çš„åŒæ—¶ä¸é‡å†™<code>clone</code>æ–¹æ³•ã€‚</p>
<p>å…³äº<code>Cloneable</code>çš„ä¸è¶³ï¼Œå¤§å®¶å¯ä»¥å»çœ‹çœ‹ã€ŠEffective Javaã€‹ä¸€ä¹¦çš„ä½œè€…<a href="http://www.artima.com/intv/bloch13.html" target="_blank" rel="external">ç»™å‡ºçš„ç†ç”±</a>ï¼Œåœ¨æ‰€ç»™é“¾æ¥çš„æ–‡ç« é‡Œï¼Œ<code>Josh Bloch</code>ä¹Ÿä¼šè®²å¦‚ä½•å®ç°æ·±æ‹·è´æ¯”è¾ƒå¥½ï¼Œæˆ‘è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚</p>
<h4 id="Mapæ¥å£"><a href="#Mapæ¥å£" class="headerlink" title="Mapæ¥å£"></a>Mapæ¥å£</h4><p>åœ¨eclipseä¸­çš„outlineé¢æ¿å¯ä»¥çœ‹åˆ° <code>Map</code> æ¥å£é‡Œé¢åŒ…å«ä»¥ä¸‹æˆå‘˜æ–¹æ³•ä¸å†…éƒ¨ç±»ï¼š</p>
<p><img src="/images/map_field_method.png" alt="Mapçš„ç»“æ„å›¾"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„æˆå‘˜æ–¹æ³•ä¸å¤–ä¹æ˜¯â€œå¢åˆ æ”¹æŸ¥â€ï¼Œè¿™ä¹Ÿåæ˜ äº†æˆ‘ä»¬ç¼–å†™ç¨‹åºæ—¶ï¼Œä¸€å®šæ˜¯ä»¥â€œæ•°æ®â€ä¸ºå¯¼å‘çš„ã€‚</p>
<p><code>Map</code> è™½ç„¶å¹¶ä¸æ˜¯Collectionï¼Œä½†æ˜¯å®ƒæä¾›äº†ä¸‰ç§â€œé›†åˆè§†è§’â€ï¼ˆcollection viewsï¼‰ï¼Œä¸ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼š</p>
<ul>
<li><code>Set&lt;K&gt; keySet()</code>ï¼Œæä¾›keyçš„é›†åˆè§†è§’</li>
<li><code>Collection&lt;V&gt; values()</code>ï¼Œæä¾›valueçš„é›†åˆè§†è§’</li>
<li><code>Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet()</code>ï¼Œæä¾›key-valueåºå¯¹çš„é›†åˆè§†è§’ï¼Œè¿™é‡Œç”¨å†…éƒ¨ç±»Map.Entryè¡¨ç¤ºåºå¯¹</li>
</ul>
<h4 id="AbstractMapæŠ½è±¡ç±»"><a href="#AbstractMapæŠ½è±¡ç±»" class="headerlink" title="AbstractMapæŠ½è±¡ç±»"></a>AbstractMapæŠ½è±¡ç±»</h4><p><code>AbstractMap</code>å¯¹ <code>Map</code> ä¸­çš„æ–¹æ³•æä¾›äº†ä¸€ä¸ªåŸºæœ¬å®ç°ï¼Œå‡å°‘äº†ç›´æ¥å®ç°<code>Map</code>æ¥å£çš„å·¥ä½œé‡ã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼š</p>
<blockquote>
<p>å¦‚æœè¦å®ç°ä¸ªä¸å¯å˜ï¼ˆunmodifiableï¼‰çš„mapï¼Œé‚£ä¹ˆåªéœ€ç»§æ‰¿AbstractMapï¼Œç„¶åå®ç°å…¶entrySetæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›çš„setä¸æ”¯æŒaddä¸removeï¼ŒåŒæ—¶è¿™ä¸ªsetçš„è¿­ä»£å™¨ï¼ˆiteratorï¼‰ä¸æ”¯æŒremoveæ“ä½œå³å¯ã€‚</p>
<p>ç›¸åï¼Œå¦‚æœè¦å®ç°ä¸ªå¯å˜ï¼ˆmodifiableï¼‰çš„mapï¼Œé¦–å…ˆç»§æ‰¿AbstractMapï¼Œç„¶åé‡å†™ï¼ˆoverrideï¼‰AbstractMapçš„putæ–¹æ³•ï¼ŒåŒæ—¶å®ç°entrySetæ‰€è¿”å›setçš„è¿­ä»£å™¨çš„removeæ–¹æ³•å³å¯ã€‚</p>
</blockquote>
<h3 id="è®¾è®¡ç†å¿µï¼ˆdesign-conceptï¼‰"><a href="#è®¾è®¡ç†å¿µï¼ˆdesign-conceptï¼‰" class="headerlink" title="è®¾è®¡ç†å¿µï¼ˆdesign conceptï¼‰"></a>è®¾è®¡ç†å¿µï¼ˆdesign conceptï¼‰</h3><h4 id="å“ˆå¸Œè¡¨ï¼ˆhash-tableï¼‰"><a href="#å“ˆå¸Œè¡¨ï¼ˆhash-tableï¼‰" class="headerlink" title="å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰"></a>å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰</h4><p><code>HashMap</code> æ˜¯ä¸€ç§åŸºäº<a href="https://en.wikipedia.org/wiki/Hash_table" target="_blank" rel="external">å“ˆå¸Œè¡¨ï¼ˆhash table)</a>å®ç°çš„mapï¼Œ<strong>å“ˆå¸Œè¡¨ï¼ˆä¹Ÿå«å…³è”æ•°ç»„</strong>ï¼‰ä¸€ç§é€šç”¨çš„æ•°æ®ç»“æ„ï¼Œå¤§å¤šæ•°çš„ç°ä»£è¯­è¨€éƒ½åŸç”Ÿæ”¯æŒï¼Œå…¶æ¦‚å¿µä¹Ÿæ¯”è¾ƒç®€å•ï¼š<code>keyç»è¿‡hashå‡½æ•°ä½œç”¨åå¾—åˆ°ä¸€ä¸ªæ§½ï¼ˆbucketsæˆ–slotsï¼‰çš„ç´¢å¼•ï¼ˆindexï¼‰ï¼Œæ§½ä¸­ä¿å­˜ç€æˆ‘ä»¬æƒ³è¦è·å–çš„å€¼</code>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="/images/hashtable.png" alt="å“ˆå¸Œè¡¨ç®€å•åŸç†å›¾"></p>
<p>å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œ<strong>ä¸€äº›ä¸åŒçš„keyç»è¿‡åŒä¸€hashå‡½æ•°åå¯èƒ½äº§ç”Ÿç›¸åŒçš„ç´¢å¼•</strong>ï¼Œä¹Ÿå°±æ˜¯äº§ç”Ÿäº†<strong>å†²çª</strong>ï¼Œè¿™æ˜¯åœ¨æ‰€éš¾å…çš„ã€‚<br>æ‰€ä»¥åˆ©ç”¨å“ˆå¸Œè¡¨è¿™ç§æ•°æ®ç»“æ„å®ç°å…·ä½“ç±»æ—¶ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>è®¾è®¡ä¸ªå¥½çš„hashå‡½æ•°ï¼Œä½¿å†²çªå°½å¯èƒ½çš„å‡å°‘</li>
<li>å…¶æ¬¡æ˜¯éœ€è¦è§£å†³å‘ç”Ÿå†²çªåå¦‚ä½•å¤„ç†ã€‚</li>
</ul>
<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><p>é¦–å…ˆä»æ„é€ å‡½æ•°å¼€å§‹è®²ï¼ŒHashMapéµå¾ª<em>é›†åˆæ¡†æ¶çš„çº¦æŸ</em>ï¼Œæä¾›äº†ä¸€ä¸ªå‚æ•°ä¸ºç©ºçš„æ„é€ å‡½æ•°ä¸æœ‰ä¸€ä¸ªå‚æ•°ä¸”å‚æ•°ç±»å‹ä¸ºMapçš„æ„é€ å‡½æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨äºè®¾ç½®HashMapçš„å®¹é‡ï¼ˆcapacityï¼‰ä¸å¹³è¡¡å› å­ï¼ˆloadFactorï¼‰ã€‚</p>
<pre><code>public HashMap(int initialCapacity, float loadFactor) {
if (initialCapacity &lt; 0)
    throw new IllegalArgumentException(&quot;Illegal initial capacity: &quot; +initialCapacity);

if (initialCapacity &gt; MAXIMUM_CAPACITY)
    initialCapacity = MAXIMUM_CAPACITY;

if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))
    throw new IllegalArgumentException(&quot;Illegal load factor: &quot; + loadFactor);

// Find a power of 2 &gt;= initialCapacity
int capacity = 1;
while (capacity &lt; initialCapacity)
    capacity &lt;&lt;= 1;    

this.loadFactor = loadFactor;
threshold = (int)Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1);

// åˆ›å»ºä¸€ä¸ªEntryçš„æ•°ç»„ï¼Œå…¶å®¹é‡å¤§å°ä¸ºcapacity
table = new Entry[capacity];
useAltHashing = sun.misc.VM.isBooted() &amp;&amp;
    (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);

init();
}

// åç»­å®Œå–„todo
public HashMap(int initialCapacity) {
this(initialCapacity, DEFAULT_LOAD_FACTOR);
}

public HashMap() {
    this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR);
}
</code></pre><p>åˆ›å»ºäº†ä¸€ä¸ªEntryæ•°ç»„ï¼Œé‚£Entryæ˜¯ä»€ä¹ˆç»“æ„å‘¢ï¼Ÿçœ‹ä¸€ä¸‹æºç ï¼š</p>
<pre><code>static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {
    final K key;
    V value;
    Entry&lt;K,V&gt; next;
    final int hash;

    Entry(int h, K k, V v, Entry&lt;K,V&gt; n) {
        value = v;
        next = n;
        key = k;
        hash = h;
    }

    // setter, getter, equals, toString æ–¹æ³•çœç•¥
    public final int hashCode() {
        //ç”¨keyçš„hashå€¼ä¸ä¸Švalueçš„hashå€¼ä½œä¸ºEntryçš„hashå€¼
        return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue());
    }

    /**
     * This method is invoked whenever the value in an entry is
     * overwritten by an invocation of put(k,v) for a key k that&apos;s already
     * in the HashMap.
     */
    void recordAccess(HashMap&lt;K,V&gt; m) {
    }

    /**
     * This method is invoked whenever the entry is
     * removed from the table.
     */
    void recordRemoval(HashMap&lt;K,V&gt; m) {
    }

}
</code></pre><p>æˆ‘ä»¬ç›®å‰åªç€é‡æ ¸å¿ƒçš„éƒ¨åˆ†ï¼ŒEntryæ˜¯ä¸€ä¸ª static class ï¼Œå…¶ä¸­åŒ…å«äº†  key å’Œ valueï¼Œä¹Ÿå°±æ˜¯é”®å€¼å¯¹ï¼Œå¦å¤–è¿˜åŒ…å«äº†ä¸€ä¸ª next çš„ Entry æŒ‡é’ˆã€‚Entryå®ç°äº†å•å‘é“¾è¡¨çš„åŠŸèƒ½ï¼Œç”¨nextæˆå‘˜å˜é‡æ¥çº§è¿èµ·æ¥ã€‚æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼š <strong>Entry å°±æ˜¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæ¯ä¸ª Entry å…¶å®å°±æ˜¯ä¸€ä¸ª key-valueå¯¹ï¼Œå®ƒæŒæœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ çš„å¼•ç”¨ï¼Œè¿™å°±æ„æˆäº†é“¾è¡¨(è¿™é‡Œæ˜¯å•å‘é“¾è¡¨ï¼Œä¸æ˜¯åŒå‘é“¾è¡¨)ã€‚</strong></p>
<p>ä»‹ç»å®ŒEntryå¯¹è±¡ï¼Œä¸‹é¢è¦è¯´ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æˆå‘˜å˜é‡</p>
<pre><code>/**
 * The table, resized as necessary. Length MUST Always be a power of two.
 */
//HashMapå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªä¸ºæ•°ç»„ç±»å‹çš„Entryå˜é‡tableï¼Œç”¨æ¥ä¿å­˜æ·»åŠ è¿›æ¥çš„    Entryå¯¹è±¡
transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;
</code></pre><h3 id="HashMap-çš„æ ¸å¿ƒæ–¹æ³•è§£è¯»"><a href="#HashMap-çš„æ ¸å¿ƒæ–¹æ³•è§£è¯»" class="headerlink" title="HashMap çš„æ ¸å¿ƒæ–¹æ³•è§£è¯»"></a>HashMap çš„æ ¸å¿ƒæ–¹æ³•è§£è¯»</h3><h4 id="å­˜å‚¨-putæ–¹æ³•-putæ“ä½œï¼ˆå«updateæ“ä½œï¼‰"><a href="#å­˜å‚¨-putæ–¹æ³•-putæ“ä½œï¼ˆå«updateæ“ä½œï¼‰" class="headerlink" title="å­˜å‚¨ putæ–¹æ³• putæ“ä½œï¼ˆå«updateæ“ä½œï¼‰"></a>å­˜å‚¨ putæ–¹æ³• putæ“ä½œï¼ˆå«updateæ“ä½œï¼‰</h4><p>putå‡½æ•°å¤§è‡´çš„æ€è·¯ä¸ºï¼š<a href="http://yikun.github.io/2015/04/01/Java-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" target="_blank" rel="external">æ¥è‡ªè¿™é‡Œ</a></p>
<ol>
<li>å¯¹keyçš„hashCode()åšhashï¼Œç„¶åå†è®¡ç®—index;</li>
<li>å¦‚æœæ²¡ç¢°æ’ç›´æ¥æ”¾åˆ°bucketé‡Œï¼›</li>
<li>å¦‚æœç¢°æ’äº†ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜åœ¨bucketsåï¼›</li>
<li>å¦‚æœç¢°æ’å¯¼è‡´é“¾è¡¨è¿‡é•¿(å¤§äºç­‰äºTREEIFY_THRESHOLD)ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼›</li>
<li>å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢old value(ä¿è¯keyçš„å”¯ä¸€æ€§)</li>
<li><p>å¦‚æœbucketæ»¡äº†(è¶…è¿‡load factor*current capacity)ï¼Œå°±è¦resizeã€‚</p>
<p> private void inflateTable(int toSize) {</p>
<pre><code>//è¾…åŠ©å‡½æ•°ï¼Œç”¨äºå¡«å……HashMapåˆ°æŒ‡å®šçš„capacity
// Find a power of 2 &gt;= toSize
int capacity = roundUpToPowerOf2(toSize);
//thresholdä¸ºresizeçš„é˜ˆå€¼ï¼Œè¶…è¿‡åHashMapä¼šè¿›è¡Œresizeï¼Œå†…å®¹çš„entryä¼šè¿›è¡Œrehash
threshold = (int) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1);
table = new Entry[capacity];
initHashSeedAsNeeded(capacity);
</code></pre><p> }</p>
<p> /**</p>
<ul>
<li>Associates the specified value with the specified key in this map.</li>
<li>If the map previously contained a mapping for the key, the old</li>
<li>value is replaced.<br>*</li>
<li>@param key key with which the specified value is to be associated</li>
<li>@param value value to be associated with the specified key</li>
<li>@return the previous value associated with <tt>key</tt>, or</li>
<li><tt>null</tt> if there was no mapping for <tt>key</tt>.</li>
<li>(A <tt>null</tt> return can also indicate that the map</li>
<li><p>previously associated <tt>null</tt> with <tt>key</tt>.)<br>*/<br>public V put(K key, V value) {<br>//å…¶å…è®¸å­˜æ”¾nullçš„keyå’Œnullçš„valueï¼Œå½“å…¶keyä¸ºnullæ—¶ï¼Œè°ƒç”¨putForNullKeyæ–¹æ³•ï¼Œæ”¾å…¥åˆ°table[0]çš„è¿™ä¸ªä½ç½®<br>if (key == null)<br>return putForNullKey(value);<br>//é€šè¿‡è°ƒç”¨hashæ–¹æ³•å¯¹keyè¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ°å“ˆå¸Œä¹‹åçš„æ•°å€¼ã€‚è¯¥æ–¹æ³•å®ç°å¯ä»¥é€šè¿‡çœ‹æºç ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†å°½å¯èƒ½çš„è®©é”®å€¼å¯¹å¯ä»¥åˆ†ä¸åˆ°ä¸åŒçš„æ¡¶ä¸­<br>int hash = hash(key);<br>//æ ¹æ®ä¸Šä¸€æ­¥éª¤ä¸­æ±‚å‡ºçš„hashå¾—åˆ°åœ¨æ•°ç»„ä¸­æ˜¯ç´¢å¼•i<br>int i = indexFor(hash, table.length);<br>//å¦‚æœiå¤„çš„Entryä¸ä¸ºnullï¼Œåˆ™é€šè¿‡å…¶nextæŒ‡é’ˆä¸æ–­éå†eå…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>// è¿™é‡Œçš„å¾ªç¯æ˜¯å…³é”®<br>// å½“æ–°å¢çš„keyæ‰€å¯¹åº”çš„ç´¢å¼•iï¼Œå¯¹åº”table[i]ä¸­å·²ç»æœ‰å€¼æ—¶ï¼Œè¿›å…¥å¾ªç¯ä½“<br>for (Entry<k,v> e = table[i]; e != null; e = e.next) {<br>Object k;<br>// åˆ¤æ–­æ˜¯å¦å­˜åœ¨æœ¬æ¬¡æ’å…¥çš„keyï¼Œå¦‚æœå­˜åœ¨ç”¨æœ¬æ¬¡çš„valueæ›¿æ¢ä¹‹å‰oldValueï¼Œç›¸å½“äºupdateæ“ä½œ<br>// å¹¶è¿”å›ä¹‹å‰çš„oldValue<br>if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {<br> V oldValue = e.value;<br> e.value = value;<br> e.recordAccess(this);<br> return oldValue;<br>}<br>}</k,v></p>
<p>// å¦‚æœiç´¢å¼•å¤„çš„Entryä¸ºnullï¼Œè¡¨æ˜æ­¤å¤„è¿˜æ²¡æœ‰Entryã€‚</p>
<p>// å¦‚æœæœ¬æ¬¡æ–°å¢keyä¹‹å‰ä¸å­˜åœ¨äºHashMapä¸­ï¼ŒmodCountåŠ 1ï¼Œè¯´æ˜ç»“æ„æ”¹å˜äº†<br>modCount++;<br>// å°†keyã€valueæ·»åŠ åˆ°iç´¢å¼•å¤„ã€‚<br>addEntry(hash, key, value, i);<br>return null;<br>}</p>
</li>
</ul>
</li>
</ol>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æ–¹æ³•çš„æ ‡å‡†æ³¨é‡Šï¼šåœ¨æ³¨é‡Šä¸­é¦–å…ˆæåˆ°äº†ï¼Œå½“æˆ‘ä»¬ put çš„æ—¶å€™ï¼Œå¦‚æœ key å­˜åœ¨äº†ï¼Œé‚£ä¹ˆæ–°çš„ value ä¼šä»£æ›¿æ—§çš„ valueï¼Œå¹¶ä¸”å¦‚æœ key å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯æ—§çš„ valueï¼Œå¦‚æœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆè¿”å› nullã€‚</p>
<p>ä»ä¸Šé¢çš„æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼šå½“æˆ‘ä»¬å¾€ HashMap ä¸­ put å…ƒç´ çš„æ—¶å€™ï¼Œå…ˆæ ¹æ® key çš„ hashCode é‡æ–°è®¡ç®— hash å€¼ï¼Œæ ¹æ® hash å€¼å¾—åˆ°è¿™ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼ˆå³ä¸‹æ ‡ï¼‰ï¼Œå¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸Šå·²ç»å­˜æ”¾æœ‰å…¶ä»–å…ƒç´ äº†ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªä½ç½®ä¸Šçš„å…ƒç´ å°†ä»¥é“¾è¡¨çš„å½¢å¼å­˜æ”¾ï¼Œæ–°åŠ å…¥çš„æ”¾åœ¨é“¾å¤´ï¼Œä¸€å¼€å§‹çš„æ—¶å€™åŠ å…¥çš„ï¼ˆæœ€å…ˆåŠ å…¥çš„ï¼‰æ”¾åœ¨é“¾å°¾ï¼ˆå¤´æ’æ³•ï¼‰ã€‚å¦‚æœæ•°ç»„è¯¥ä½ç½®ä¸Šæ²¡æœ‰å…ƒç´ ï¼Œå°±ç›´æ¥å°†è¯¥å…ƒç´ æ”¾åˆ°æ­¤æ•°ç»„ä¸­çš„è¯¥ä½ç½®ä¸Šã€‚</p>
<p>addEntry(hash, key, value, i)æ–¹æ³•æ ¹æ®è®¡ç®—å‡ºçš„ hash å€¼ï¼Œå°† key-value å¯¹æ”¾åœ¨æ•°ç»„ table çš„ i ç´¢å¼•å¤„ã€‚addEntry æ˜¯ HashMap æä¾›çš„ä¸€ä¸ªåŒ…è®¿é—®æƒé™çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>/**
 * Adds a new entry with the specified key, value and hash code to
 * the specified bucket.  It is the responsibility of this
 * method to resize the table if appropriate.
 *
 * Subclass overrides this to alter the behavior of put method.
 */
void addEntry(int hash, K key, V value, int bucketIndex) {
    // å¦‚æœå¢åŠ ä¸€ä¸ªå…ƒç´ è¿‡åï¼ŒHashMapçš„å¤§å°è¶…è¿‡é˜ˆå€¼,éœ€è¦resizeæ“ä½œ
    if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) {
        // å¢åŠ çš„å¹…åº¦æ˜¯ä¹‹å‰çš„å€
        resize(2 * table.length);
        hash = (null != key) ? hash(key) : 0;
        bucketIndex = indexFor(hash, table.length);
    }

    createEntry(hash, key, value, bucketIndex);
}

void createEntry(int hash, K key, V value, int bucketIndex) {
    // è·å–æŒ‡å®š bucketIndex ç´¢å¼•å¤„çš„ Entryï¼ˆå…¶å®å°±æ˜¯æ•°ç»„ä¸­ç´¢å¼•ä¸ºbucketIndexå¤„çš„é‚£ä¸ªå…ƒç´ ï¼Œç„¶åé‚£ä¸ªå…ƒç´ æ˜¯é“¾è¡¨çš„å¤´éƒ¨ï¼‰
    // é¦–å…ˆå¾—åˆ°è¯¥ç´¢å¼•å¤„çš„å†²çªé“¾Entriesï¼Œç¬¬ä¸€æ¬¡æ’å…¥bucketIndexä½ç½®æ—¶å†²çªé“¾ä¸ºnullï¼Œä¹Ÿå°±æ˜¯eä¸ºnull
    Entry&lt;K,V&gt; e = table[bucketIndex];
    // ç„¶åå°†æ–°åˆ›å»ºçš„ Entry æ”¾å…¥ bucketIndex ç´¢å¼•å¤„ï¼Œå¹¶è®©æ–°çš„ Entry æŒ‡å‘åŸæ¥çš„ Entryï¼ˆä¹Ÿå°±æ˜¯åˆšåˆšæ’å…¥çš„Entryæˆä¸ºå†²çªé“¾çš„å¼€å¤´ï¼Œåœ¨è¿™ä¹‹å‰æ’å…¥çš„Entryåœ¨é“¾è¡¨çš„åé¢ï¼‰
    table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e);
    size++;
}
</code></pre><p>å½“ç³»ç»Ÿå†³å®šå­˜å‚¨ HashMap ä¸­çš„ key-value å¯¹æ—¶ï¼Œå®Œå…¨æ²¡æœ‰è€ƒè™‘ Entry ä¸­çš„ valueï¼Œ<strong>ä»…ä»…åªæ˜¯æ ¹æ® key æ¥è®¡ç®—å¹¶å†³å®šæ¯ä¸ª Entry çš„å­˜å‚¨ä½ç½®ã€‚æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠ Map é›†åˆä¸­çš„ value å½“æˆ key çš„é™„å±ï¼Œ</strong>å½“ç³»ç»Ÿå†³å®šäº† key çš„å­˜å‚¨ä½ç½®ä¹‹åï¼Œvalue éšä¹‹ä¿å­˜åœ¨é‚£é‡Œå³å¯ã€‚</p>
<pre><code>//ä¸‹é¢çœ‹çœ‹HashMapæ˜¯å¦‚ä½•è¿›è¡Œresizeï¼Œåºå±±çœŸé¢ç›®å°±è¦æ­æ™“äº†ğŸ˜Š
void resize(int newCapacity) {
    Entry[] oldTable = table;
    int oldCapacity = oldTable.length;
    //å¦‚æœå·²ç»è¾¾åˆ°æœ€å¤§å®¹é‡ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›
    if (oldCapacity == MAXIMUM_CAPACITY) {
        threshold = Integer.MAX_VALUE;
        return;
}
Entry[] newTable = new Entry[newCapacity];
//initHashSeedAsNeeded(newCapacity)çš„è¿”å›å€¼å†³å®šäº†æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—Entryçš„hashå€¼
transfer(newTable, initHashSeedAsNeeded(newCapacity));
table = newTable;
threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);
}
/**
  * Transfers all entries from current table to  newTable.
  */
void transfer(Entry[] newTable, boolean rehash) {
int newCapacity = newTable.length;
//éå†å½“å‰çš„tableï¼Œå°†é‡Œé¢çš„å…ƒç´ æ·»åŠ åˆ°æ–°çš„newTableä¸­
for (Entry&lt;K,V&gt; e : table) {
    while(null != e) {
        Entry&lt;K,V&gt; next = e.next;
        if (rehash) {
            e.hash = null == e.key ? 0 : hash(e.key);
        }
        int i = indexFor(e.hash, newCapacity);
        e.next = newTable[i];
        //æœ€åè¿™ä¸¤å¥ç”¨äº†ä¸putæ”¾è¿‡ç›¸åŒçš„æŠ€å·§
        //å°†åæ’å…¥çš„åè€Œåœ¨å‰é¢
        newTable[i] = e;
        e = next;
    }
}
}
/**
 * Initialize the hashing mask value. We defer initialization until we
 * really need it.
 */
final boolean initHashSeedAsNeeded(int capacity) {
    boolean currentAltHashing = hashSeed != 0;
    boolean useAltHashing = sun.misc.VM.isBooted() &amp;&amp;
            (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);
    //è¿™é‡Œè¯´æ˜äº†ï¼Œåœ¨hashSeedä¸ä¸º0æˆ–æ»¡è¶³useAltHashæ—¶ï¼Œä¼šé‡ç®—Entryçš„hashå€¼
    //è‡³äºuseAltHashingçš„ä½œç”¨å¯ä»¥å‚è€ƒä¸‹é¢çš„é“¾æ¥
    // http://stackoverflow.com/questions/29918624/what-is-the-use-of-holder-class-in-hashmap
    boolean switching = currentAltHashing ^ useAltHashing;
    if (switching) {
        hashSeed = useAltHashing
            ? sun.misc.Hashing.randomHashSeed(this)
            : 0;
    }
    return switching;
}
</code></pre><p>hash(int h)æ–¹æ³•æ ¹æ® key çš„ hashCode é‡æ–°è®¡ç®—ä¸€æ¬¡æ•£åˆ—ã€‚æ­¤ç®—æ³•åŠ å…¥äº†é«˜ä½è®¡ç®—ï¼Œé˜²æ­¢ä½ä½ä¸å˜ï¼Œé«˜ä½å˜åŒ–æ—¶ï¼Œé€ æˆçš„ hash å†²çªã€‚</p>
<pre><code>final int hash(Object k) {
    int h = 0;
    if (useAltHashing) {
        if (k instanceof String) {
            return sun.misc.Hashing.stringHash32((String) k);
        }
        h = hashSeed;
    }
    //å¾—åˆ°kçš„hashcodeå€¼
    h ^= k.hashCode();
    //è¿›è¡Œè®¡ç®—
    h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);
    return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);
}
</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ HashMap ä¸­è¦æ‰¾åˆ°æŸä¸ªå…ƒç´ ï¼Œéœ€è¦æ ¹æ® key çš„ hash å€¼æ¥æ±‚å¾—å¯¹åº”æ•°ç»„ä¸­çš„ä½ç½®ã€‚å¦‚ä½•è®¡ç®—è¿™ä¸ªä½ç½®å°±æ˜¯ hash ç®—æ³•ã€‚å‰é¢è¯´è¿‡ HashMap çš„æ•°æ®ç»“æ„æ˜¯æ•°ç»„å’Œé“¾è¡¨çš„ç»“åˆï¼Œæ‰€ä»¥æˆ‘ä»¬å½“ç„¶å¸Œæœ›è¿™ä¸ª HashMap é‡Œé¢çš„ å…ƒç´ ä½ç½®å°½é‡çš„åˆ†å¸ƒå‡åŒ€äº›ï¼Œå°½é‡ä½¿å¾—æ¯ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æ•°é‡åªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ç”¨ hash ç®—æ³•æ±‚å¾—è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±å¯ä»¥çŸ¥é“å¯¹åº”ä½ç½®çš„å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦çš„ï¼Œè€Œä¸ç”¨å†å»éå†é“¾è¡¨ï¼Œè¿™æ ·å°±å¤§å¤§ä¼˜åŒ–äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚</p>
<p>å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„ hashCode() è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨ hash(int h) æ–¹æ³•æ‰€è®¡ç®—å¾—åˆ°çš„ hash ç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠ hash å€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œâ€œæ¨¡â€è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåœ¨ HashMap ä¸­æ˜¯è¿™æ ·åšçš„ï¼šè°ƒç”¨ indexFor(int h, int length) æ–¹æ³•æ¥è®¡ç®—è¯¥å¯¹è±¡åº”è¯¥ä¿å­˜åœ¨ table æ•°ç»„çš„å“ªä¸ªç´¢å¼•å¤„ã€‚indexFor(int h, int length) æ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>/**
 * Returns index for hash code h.
 */
static int indexFor(int h, int length) {  
return h &amp; (length-1);
}
</code></pre><p>è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡ h &amp; (table.length -1) æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€Œ HashMap åº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œè¿™æ˜¯ HashMap åœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚åœ¨ HashMap æ„é€ å™¨ä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code>// Find a power of 2 &gt;= initialCapacity
int capacity = 1;
while (capacity &lt; initialCapacity)  
    capacity &lt;&lt;= 1;
</code></pre><p>è¿™æ®µä»£ç ä¿è¯åˆå§‹åŒ–æ—¶ HashMap çš„å®¹é‡æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œå³åº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ä¸º 2 çš„ n æ¬¡æ–¹ã€‚</p>
<p>å½“ length æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹ length å–æ¨¡ï¼Œä¹Ÿå°±æ˜¯ h%lengthï¼Œä½†æ˜¯ &amp; æ¯” % å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚è¿™çœ‹ä¸Šå»å¾ˆç®€å•ï¼Œå…¶å®æ¯”è¾ƒæœ‰ç„æœºçš„ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p>
<p>å‡è®¾æ•°ç»„é•¿åº¦åˆ†åˆ«ä¸º 15 å’Œ 16ï¼Œä¼˜åŒ–åçš„ hash ç åˆ†åˆ«ä¸º 8 å’Œ 9ï¼Œé‚£ä¹ˆ &amp; è¿ç®—åçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p>h &amp; (table.length-1)    hash        table.length-1<br>8 &amp; (15-1)ï¼š    0100    &amp;    1110    = 0100<br>9 &amp; (15-1)ï¼š    0101    &amp;    1110    = 0100<br>8 &amp; (16-1)ï¼š    0100    &amp;    1111    = 0100<br>9 &amp; (16-1)ï¼š    0101    &amp;    1111    = 0101</p>
<p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºï¼šå½“å®ƒä»¬å’Œ 15-1ï¼ˆ1110ï¼‰â€œä¸â€çš„æ—¶å€™ï¼Œäº§ç”Ÿäº†ç›¸åŒçš„ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬ä¼šå®šä½åˆ°æ•°ç»„ä¸­çš„åŒä¸€ä¸ªä½ç½®ä¸Šå»ï¼Œè¿™å°±äº§ç”Ÿäº†ç¢°æ’ï¼Œ8 å’Œ 9 ä¼šè¢«æ”¾åˆ°æ•°ç»„ä¸­çš„åŒä¸€ä¸ªä½ç½®ä¸Šå½¢æˆé“¾è¡¨ï¼Œé‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™å°±éœ€è¦éå†è¿™ä¸ªé“¾ è¡¨ï¼Œå¾—åˆ°8æˆ–è€…9ï¼Œè¿™æ ·å°±é™ä½äº†æŸ¥è¯¢çš„æ•ˆç‡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œå½“æ•°ç»„é•¿åº¦ä¸º 15 çš„æ—¶å€™ï¼Œhash å€¼ä¼šä¸ 15-1ï¼ˆ1110ï¼‰è¿›è¡Œâ€œä¸â€ï¼Œé‚£ä¹ˆæœ€åä¸€ä½æ°¸è¿œæ˜¯ 0ï¼Œè€Œ 0001ï¼Œ0011ï¼Œ0101ï¼Œ1001ï¼Œ1011ï¼Œ0111ï¼Œ1101 è¿™å‡ ä¸ªä½ç½®æ°¸è¿œéƒ½ä¸èƒ½å­˜æ”¾å…ƒç´ äº†ï¼Œç©ºé—´æµªè´¹ç›¸å½“å¤§ï¼Œæ›´ç³Ÿçš„æ˜¯è¿™ç§æƒ…å†µä¸­ï¼Œæ•°ç»„å¯ä»¥ä½¿ç”¨çš„ä½ç½®æ¯”æ•°ç»„é•¿åº¦å°äº†å¾ˆå¤šï¼Œè¿™æ„å‘³ç€è¿›ä¸€æ­¥å¢åŠ äº†ç¢°æ’çš„å‡ ç‡ï¼Œå‡æ…¢äº†æŸ¥è¯¢çš„æ•ˆç‡ï¼è€Œå½“æ•°ç»„é•¿åº¦ä¸º16æ—¶ï¼Œå³ä¸º2çš„næ¬¡æ–¹æ—¶ï¼Œ2n-1 å¾—åˆ°çš„äºŒè¿›åˆ¶æ•°çš„æ¯ä¸ªä½ä¸Šçš„å€¼éƒ½ä¸º 1ï¼Œè¿™ä½¿å¾—åœ¨ä½ä½ä¸Š&amp;æ—¶ï¼Œå¾—åˆ°çš„å’ŒåŸ hash çš„ä½ä½ç›¸åŒï¼ŒåŠ ä¹‹ hash(int h)æ–¹æ³•å¯¹ key çš„ hashCode çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ŒåŠ å…¥äº†é«˜ä½è®¡ç®—ï¼Œå°±ä½¿å¾—åªæœ‰ç›¸åŒçš„ hash å€¼çš„ä¸¤ä¸ªå€¼æ‰ä¼šè¢«æ”¾åˆ°æ•°ç»„ä¸­çš„åŒä¸€ä¸ªä½ç½®ä¸Šå½¢æˆé“¾è¡¨ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼Œå½“æ•°ç»„é•¿åº¦ä¸º 2 çš„ n æ¬¡å¹‚çš„æ—¶å€™ï¼Œä¸åŒçš„ key ç®—å¾—å¾— index ç›¸åŒçš„å‡ ç‡è¾ƒå°ï¼Œé‚£ä¹ˆæ•°æ®åœ¨æ•°ç»„ä¸Šåˆ†å¸ƒå°±æ¯”è¾ƒå‡åŒ€ï¼Œä¹Ÿå°±æ˜¯è¯´ç¢°æ’çš„å‡ ç‡å°ï¼Œç›¸å¯¹çš„ï¼ŒæŸ¥è¯¢çš„æ—¶å€™å°±ä¸ç”¨éå†æŸä¸ªä½ç½®ä¸Šçš„é“¾è¡¨ï¼Œè¿™æ ·æŸ¥è¯¢æ•ˆç‡ä¹Ÿå°±è¾ƒé«˜äº†ã€‚</p>
<p>æ ¹æ®ä¸Šé¢ put æ–¹æ³•çš„æºä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“ç¨‹åºè¯•å›¾å°†ä¸€ä¸ªkey-valueå¯¹æ”¾å…¥HashMapä¸­æ—¶ï¼Œç¨‹åºé¦–å…ˆæ ¹æ®è¯¥ key çš„ hashCode() è¿”å›å€¼å†³å®šè¯¥ Entry çš„å­˜å‚¨ä½ç½®ï¼šå¦‚æœä¸¤ä¸ª Entry çš„ key çš„ hashCode() è¿”å›å€¼ç›¸åŒï¼Œé‚£å®ƒä»¬çš„å­˜å‚¨ä½ç½®ç›¸åŒã€‚å¦‚æœè¿™ä¸¤ä¸ª Entry çš„ key é€šè¿‡ equals æ¯”è¾ƒè¿”å› trueï¼Œæ–°æ·»åŠ  Entry çš„ value å°†è¦†ç›–é›†åˆä¸­åŸæœ‰ Entry çš„ valueï¼Œä½†keyä¸ä¼šè¦†ç›–ã€‚å¦‚æœè¿™ä¸¤ä¸ª Entry çš„ key é€šè¿‡ equals æ¯”è¾ƒè¿”å› falseï¼Œæ–°æ·»åŠ çš„ Entry å°†ä¸é›†åˆä¸­åŸæœ‰ Entry å½¢æˆ Entry é“¾ï¼Œè€Œä¸”æ–°æ·»åŠ çš„ Entry ä½äº Entry é“¾çš„å¤´éƒ¨â€”â€”å…·ä½“è¯´æ˜ç»§ç»­çœ‹ addEntry() æ–¹æ³•çš„è¯´æ˜ã€‚</p>
<h4 id="è¯»å–-getæ–¹æ³•-getæ“ä½œ"><a href="#è¯»å–-getæ–¹æ³•-getæ“ä½œ" class="headerlink" title="è¯»å– getæ–¹æ³• getæ“ä½œ"></a>è¯»å– getæ–¹æ³• getæ“ä½œ</h4><p>getå¤§è‡´æ€è·¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>bucketé‡Œçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥å‘½ä¸­ï¼›</li>
<li>å¦‚æœæœ‰å†²çªï¼Œåˆ™é€šè¿‡key.equals(k)å»æŸ¥æ‰¾å¯¹åº”çš„entry</li>
<li>è‹¥ä¸ºæ ‘ï¼Œåˆ™åœ¨æ ‘ä¸­é€šè¿‡key.equals(k)æŸ¥æ‰¾ï¼ŒO(logn)ï¼›</li>
<li><p>è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™åœ¨é“¾è¡¨ä¸­é€šè¿‡key.equals(k)æŸ¥æ‰¾ï¼ŒO(n)ã€‚</p>
<p> /**</p>
<ul>
<li>Returns the value to which the specified key is mapped,</li>
<li>or {@code null} if this map contains no mapping for the key.<br>*</li>
<li><p>More formally, if this map contains a mapping from a key</p></li>
<li>{@code k} to a value {@code v} such that {@code (key==null ? k==null :</li>
<li>key.equals(k))}, then this method returns {@code v}; otherwise</li>
<li>it returns {@code null}.  (There can be at most one such mapping.)<br>*</li>
<li><p>A return value of {@code null} does not <i>necessarily</i></p></li>
<li>indicate that the map contains no mapping for the key; itâ€™s also</li>
<li>possible that the map explicitly maps the key to {@code null}.</li>
<li>The {@link #containsKey containsKey} operation may be used to</li>
<li>distinguish these two cases.<br>*</li>
<li><p>@see #put(Object, Object)<br>*/<br>public V get(Object key) {<br> // å•ç‹¬å¤„ç†keyä¸ºnullçš„æƒ…å†µ<br> if (key == null)</p>
<pre><code>return getForNullKey();
</code></pre><p> // keyä¸ä¸ºnullçš„æƒ…å†µ<br> Entry<k,v> entry = getEntry(key);</k,v></p>
<p> return null == entry ? null : entry.getValue();<br>}</p>
<p>private V getForNullKey() {<br> if (size == 0) {</p>
<pre><code>return null;
</code></pre><p> }<br> //keyä¸ºnullçš„Entryç”¨äºæ”¾åœ¨table[0]ä¸­ï¼Œä½†æ˜¯åœ¨table[0]å†²çªé“¾ä¸­çš„Entryçš„keyä¸ä¸€å®šä¸ºnull<br> //æ‰€ä»¥éœ€è¦éå†å†²çªé“¾ï¼ŒæŸ¥æ‰¾keyæ˜¯å¦å­˜åœ¨<br> for (Entry<k,v> e = table[0]; e != null; e = e.next) {</k,v></p>
<pre><code>if (e.key == null)
    return e.value;
</code></pre><p> }<br> return null;<br>}</p>
<p>final Entry<k,v> getEntry(Object key) {<br> int hash = (key == null) ? 0 : hash(key);<br> // é¦–å…ˆå®šä½åˆ°ç´¢å¼•åœ¨tableä¸­çš„ä½ç½®<br> // ç„¶åéå†å†²çªé“¾ï¼ŒæŸ¥æ‰¾keyæ˜¯å¦å­˜åœ¨<br> for (Entry<k,v> e = table[indexFor(hash, table.length)];</k,v></k,v></p>
<pre><code> e != null;
 e = e.next) {
Object k;
// è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå…³é”®ç‚¹ å¦‚æœä¸¤ä¸ªé”®çš„hashcodeç›¸åŒï¼Œä½ å¦‚ä½•è·å–å€¼å¯¹è±¡ï¼Ÿ
// å…¶ä¸­ä¸€äº›è®°å¾—è¿™ä¸ªé‡è¦çŸ¥è¯†ç‚¹çš„é¢è¯•è€…ä¼šè¯´ï¼Œæ‰¾åˆ°bucketä½ç½®ä¹‹åï¼Œä¼šè°ƒç”¨keys.equals()æ–¹æ³•å»æ‰¾åˆ°é“¾è¡¨ä¸­æ­£ç¡®çš„èŠ‚ç‚¹ï¼Œæœ€ç»ˆæ‰¾åˆ°è¦æ‰¾çš„å€¼å¯¹è±¡ã€‚å®Œç¾çš„ç­”æ¡ˆï¼
if (e.hash == hash &amp;&amp;
    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))
    return e;
</code></pre><p> }<br> return null;<br>}</p>
</li>
</ul>
</li>
</ol>
<p>æœ‰äº†ä¸Šé¢å­˜å‚¨æ—¶çš„ hash ç®—æ³•ä½œä¸ºåŸºç¡€ï¼Œç†è§£èµ·æ¥è¿™æ®µä»£ç å°±å¾ˆå®¹æ˜“äº†ã€‚ä»ä¸Šé¢çš„æºä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼šä» HashMap ä¸­ get å…ƒç´ æ—¶ï¼Œé¦–å…ˆè®¡ç®— key çš„ hashCodeï¼Œæ‰¾åˆ°æ•°ç»„ä¸­å¯¹åº”ä½ç½®çš„æŸä¸€å…ƒç´ ï¼Œç„¶åé€šè¿‡ key çš„ equals æ–¹æ³•åœ¨å¯¹åº”ä½ç½®çš„é“¾è¡¨ä¸­æ‰¾åˆ°éœ€è¦çš„å…ƒç´ ã€‚</p>
<h4 id="removeæ–¹æ³•-removeæ“ä½œ"><a href="#removeæ–¹æ³•-removeæ“ä½œ" class="headerlink" title="removeæ–¹æ³• removeæ“ä½œ"></a>removeæ–¹æ³• removeæ“ä½œ</h4><pre><code>public V remove(Object key) {
    Entry&lt;K,V&gt; e = removeEntryForKey(key);
    //å¯ä»¥çœ‹åˆ°åˆ é™¤çš„keyå¦‚æœå­˜åœ¨ï¼Œå°±è¿”å›å…¶æ‰€å¯¹åº”çš„value
    return (e == null ? null : e.value);
}

final Entry&lt;K,V&gt; removeEntryForKey(Object key) {
    if (size == 0) {
        return null;
    }
    int hash = (key == null) ? 0 : hash(key);
    int i = indexFor(hash, table.length);
    //è¿™é‡Œç”¨äº†ä¸¤ä¸ªEntryå¯¹è±¡ï¼Œç›¸å½“äºä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸ºçš„æ˜¯é˜²æ²»å†²çªé“¾å‘ç”Ÿæ–­è£‚çš„æƒ…å†µ
    //è¿™é‡Œçš„æ€è·¯å°±æ˜¯ä¸€èˆ¬çš„å•å‘é“¾è¡¨çš„åˆ é™¤æ€è·¯
    Entry&lt;K,V&gt; prev = table[i];
    Entry&lt;K,V&gt; e = prev;
    //å½“table[i]ä¸­å­˜åœ¨å†²çªé“¾æ—¶ï¼Œå¼€å§‹éå†é‡Œé¢çš„å…ƒç´ 
    while (e != null) {
        Entry&lt;K,V&gt; next = e.next;
        Object k;
        if (e.hash == hash &amp;&amp;
            ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) {
            modCount++;
            size--;
            if (prev == e) //å½“å†²çªé“¾åªæœ‰ä¸€ä¸ªEntryæ—¶
                table[i] = next;
            else
                prev.next = next;
            e.recordRemoval(this);
            return e;
        }
        prev = e;
        e = next;
    }
    return e;
}
</code></pre><h3 id="å½’çº³"><a href="#å½’çº³" class="headerlink" title="å½’çº³"></a>å½’çº³</h3><blockquote>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼ŒHashMapçš„å¢åˆ æ”¹æŸ¥éƒ½ä»‹ç»å®Œäº†ã€‚<br>ä¸€èˆ¬è€Œè¨€ï¼Œè®¤ä¸ºHashMapçš„è¿™å››ç§æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œå› ä¸ºå®ƒhashå‡½æ•°æ€§è´¨è¾ƒå¥½ï¼Œä¿è¯äº†å†²çªå‘ç”Ÿçš„å‡ ç‡è¾ƒå°ã€‚</p>
</blockquote>
<p><strong>ç®€å•åœ°è¯´ï¼ŒHashMap åœ¨åº•å±‚å°† key-value å½“æˆä¸€ä¸ªæ•´ä½“è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ•´ä½“å°±æ˜¯ä¸€ä¸ª Entry å¯¹è±¡ã€‚HashMap åº•å±‚é‡‡ç”¨ä¸€ä¸ª Entry[] æ•°ç»„æ¥ä¿å­˜æ‰€æœ‰çš„ key-value å¯¹ï¼Œå½“éœ€è¦å­˜å‚¨ä¸€ä¸ª Entry å¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ® hash ç®—æ³•æ¥å†³å®šå…¶åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œåœ¨æ ¹æ® equals æ–¹æ³•å†³å®šå…¶åœ¨è¯¥æ•°ç»„ä½ç½®ä¸Šçš„é“¾è¡¨ä¸­çš„å­˜å‚¨ä½ç½®ï¼›å½“éœ€è¦å–å‡ºä¸€ä¸ªEntry æ—¶ï¼Œä¹Ÿä¼šæ ¹æ® hash ç®—æ³•æ‰¾åˆ°å…¶åœ¨æ•°ç»„ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œå†æ ¹æ® equals æ–¹æ³•ä»è¯¥ä½ç½®ä¸Šçš„é“¾è¡¨ä¸­å–å‡ºè¯¥Entryã€‚</strong></p>
<h4 id="HashMap-çš„-resizeï¼ˆrehashï¼‰"><a href="#HashMap-çš„-resizeï¼ˆrehashï¼‰" class="headerlink" title="HashMap çš„ resizeï¼ˆrehashï¼‰"></a>HashMap çš„ resizeï¼ˆrehashï¼‰</h4><p>å½“ HashMap ä¸­çš„å…ƒç´ è¶Šæ¥è¶Šå¤šçš„æ—¶å€™ï¼Œhash å†²çªçš„å‡ ç‡ä¹Ÿå°±è¶Šæ¥è¶Šé«˜ï¼Œå› ä¸ºæ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥ä¸ºäº†æé«˜æŸ¥è¯¢çš„æ•ˆç‡ï¼Œå°±è¦å¯¹ HashMap çš„æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œæ•°ç»„æ‰©å®¹è¿™ä¸ªæ“ä½œä¹Ÿä¼šå‡ºç°åœ¨ ArrayList ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æ“ä½œï¼Œè€Œåœ¨ HashMap æ•°ç»„æ‰©å®¹ä¹‹åï¼Œæœ€æ¶ˆè€—æ€§èƒ½çš„ç‚¹å°±å‡ºç°äº†ï¼šåŸæ•°ç»„ä¸­çš„æ•°æ®å¿…é¡»é‡æ–°è®¡ç®—å…¶åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¹¶æ”¾è¿›å»ï¼Œè¿™å°±æ˜¯ resizeã€‚</p>
<p>é‚£ä¹ˆ HashMap ä»€ä¹ˆæ—¶å€™è¿›è¡Œæ‰©å®¹å‘¢ï¼Ÿå½“ HashMap ä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡æ•°ç»„å¤§å° <em>loadFactoræ—¶ï¼Œå°±ä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼ŒloadFactorçš„é»˜è®¤å€¼ä¸º 0.75ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„å–å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°ç»„å¤§å°ä¸º 16ï¼Œé‚£ä¹ˆå½“ HashMap ä¸­å…ƒç´ ä¸ªæ•°è¶…è¿‡ 16</em>0.75=12 çš„æ—¶å€™ï¼Œå°±æŠŠæ•°ç»„çš„å¤§å°æ‰©å±•ä¸º 2*16=32ï¼Œå³æ‰©å¤§ä¸€å€ï¼Œç„¶åé‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œè€Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—æ€§èƒ½çš„æ“ä½œï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å·²ç»é¢„çŸ¥ HashMap ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œé‚£ä¹ˆé¢„è®¾å…ƒç´ çš„ä¸ªæ•°èƒ½å¤Ÿæœ‰æ•ˆçš„æé«˜ HashMap çš„æ€§èƒ½ã€‚</p>
<h4 id="HashMap-çš„æ€§èƒ½å‚æ•°"><a href="#HashMap-çš„æ€§èƒ½å‚æ•°" class="headerlink" title="HashMap çš„æ€§èƒ½å‚æ•°"></a>HashMap çš„æ€§èƒ½å‚æ•°</h4><p>HashMap åŒ…å«å¦‚ä¸‹å‡ ä¸ªæ„é€ å™¨ï¼š</p>
<ul>
<li>HashMap()ï¼šæ„å»ºä¸€ä¸ªåˆå§‹å®¹é‡ä¸º 16ï¼Œè´Ÿè½½å› å­ä¸º 0.75 çš„ HashMapã€‚</li>
<li>ashMap(int initialCapacity)ï¼šæ„å»ºä¸€ä¸ªåˆå§‹å®¹é‡ä¸º initialCapacityï¼Œè´Ÿè½½å› å­ä¸º 0.75 çš„ HashMapã€‚</li>
<li>HashMap(int initialCapacity, float loadFactor)ï¼šä»¥æŒ‡å®šåˆå§‹å®¹é‡ã€æŒ‡å®šçš„è´Ÿè½½å› å­åˆ›å»ºä¸€ä¸ª HashMapã€‚</li>
</ul>
<p>HashMap çš„åŸºç¡€æ„é€ å™¨ HashMap(int initialCapacity, float loadFactor) å¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå®ƒä»¬æ˜¯åˆå§‹å®¹é‡ initialCapacity å’Œè´Ÿè½½å› å­ loadFactorã€‚</p>
<p>è´Ÿè½½å› å­ loadFactor è¡¡é‡çš„æ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨çš„ç©ºé—´çš„ä½¿ç”¨ç¨‹åº¦ï¼Œè´Ÿè½½å› å­è¶Šå¤§è¡¨ç¤ºæ•£åˆ—è¡¨çš„è£…å¡«ç¨‹åº¦è¶Šé«˜ï¼Œåä¹‹æ„ˆå°ã€‚å¯¹äºä½¿ç”¨é“¾è¡¨æ³•çš„æ•£åˆ—è¡¨æ¥è¯´ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ çš„å¹³å‡æ—¶é—´æ˜¯ O(1+a)ï¼Œå› æ­¤å¦‚æœè´Ÿè½½å› å­è¶Šå¤§ï¼Œå¯¹ç©ºé—´çš„åˆ©ç”¨æ›´å……åˆ†ï¼Œç„¶è€Œåæœæ˜¯æŸ¥æ‰¾æ•ˆç‡çš„é™ä½ï¼›å¦‚æœè´Ÿè½½å› å­å¤ªå°ï¼Œé‚£ä¹ˆæ•£åˆ—è¡¨çš„æ•°æ®å°†è¿‡äºç¨€ç–ï¼Œå¯¹ç©ºé—´é€ æˆä¸¥é‡æµªè´¹ã€‚</p>
<p>HashMap çš„å®ç°ä¸­ï¼Œé€šè¿‡ threshold å­—æ®µæ¥åˆ¤æ–­ HashMap çš„æœ€å¤§å®¹é‡ï¼š<br><code>threshold = (int)(capacity * loadFactor);</code></p>
<p>ç»“åˆè´Ÿè½½å› å­çš„å®šä¹‰å…¬å¼å¯çŸ¥ï¼Œthreshold å°±æ˜¯åœ¨æ­¤ loadFactor å’Œ capacity å¯¹åº”ä¸‹å…è®¸çš„æœ€å¤§å…ƒç´ æ•°ç›®ï¼Œè¶…è¿‡è¿™ä¸ªæ•°ç›®å°±é‡æ–° resizeï¼Œä»¥é™ä½å®é™…çš„è´Ÿè½½å› å­ã€‚é»˜è®¤çš„çš„è´Ÿè½½å› å­ 0.75 æ˜¯å¯¹ç©ºé—´å’Œæ—¶é—´æ•ˆç‡çš„ä¸€ä¸ªå¹³è¡¡é€‰æ‹©ã€‚å½“å®¹é‡è¶…å‡ºæ­¤æœ€å¤§å®¹é‡æ—¶ï¼Œ resize åçš„ HashMap å®¹é‡æ˜¯å®¹é‡çš„ä¸¤å€ã€‚</p>
<h4 id="Fail-Fast-æœºåˆ¶"><a href="#Fail-Fast-æœºåˆ¶" class="headerlink" title="Fail-Fast æœºåˆ¶"></a>Fail-Fast æœºåˆ¶</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>æˆ‘ä»¬çŸ¥é“ java.util.HashMap ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¦‚æœåœ¨ä½¿ç”¨è¿­ä»£å™¨çš„è¿‡ç¨‹ä¸­æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº† mapï¼Œé‚£ä¹ˆå°†æŠ›å‡º ConcurrentModificationExceptionï¼Œè¿™å°±æ˜¯æ‰€è°“ fail-fast ç­–ç•¥ã€‚</p>
<p>ail-fast æœºåˆ¶æ˜¯ java é›†åˆ(Collection)ä¸­çš„ä¸€ç§é”™è¯¯æœºåˆ¶ã€‚ å½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé›†åˆçš„å†…å®¹è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿ fail-fast äº‹ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹ A é€šè¿‡ iteratorå»éå†æŸé›†åˆçš„è¿‡ç¨‹ä¸­ï¼Œè‹¥è¯¥é›†åˆçš„å†…å®¹è¢«å…¶ä»–çº¿ç¨‹æ‰€æ”¹å˜äº†ï¼›é‚£ä¹ˆçº¿ç¨‹ A è®¿é—®é›†åˆæ—¶ï¼Œå°±ä¼šæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ï¼Œäº§ç”Ÿ fail-fast äº‹ä»¶ã€‚</p>
<p>è¿™ä¸€ç­–ç•¥åœ¨æºç ä¸­çš„å®ç°æ˜¯é€šè¿‡ modCount åŸŸï¼ŒmodCount é¡¾åæ€ä¹‰å°±æ˜¯ä¿®æ”¹æ¬¡æ•°ï¼Œå¯¹ HashMap å†…å®¹ï¼ˆå½“ç„¶ä¸ä»…ä»…æ˜¯ HashMap æ‰ä¼šæœ‰ï¼Œå…¶ä»–ä¾‹å¦‚ ArrayList ä¹Ÿä¼šï¼‰çš„ä¿®æ”¹éƒ½å°†å¢åŠ è¿™ä¸ªå€¼ï¼ˆå¤§å®¶å¯ä»¥å†å›å¤´çœ‹ä¸€ä¸‹å…¶æºç ï¼Œåœ¨å¾ˆå¤šæ“ä½œä¸­éƒ½æœ‰ modCount++ è¿™å¥ï¼‰ï¼Œé‚£ä¹ˆåœ¨è¿­ä»£å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¼šå°†è¿™ä¸ªå€¼èµ‹ç»™è¿­ä»£å™¨çš„ expectedModCountã€‚</p>
<pre><code>HashIterator() {
    expectedModCount = modCount;
    if (size &gt; 0) { // advance to first entry
    Entry[] t = table;
    while (index &lt; t.length &amp;&amp; (next = t[index++]) == null)  
        ;
    }
}
</code></pre><p>åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­ modCount è·Ÿ expectedModCount æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰å°±è¡¨ç¤ºå·²ç»æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº† Mapï¼š</p>
<p>æ³¨æ„åˆ° modCount å£°æ˜ä¸º volatileï¼Œä¿è¯çº¿ç¨‹ä¹‹é—´ä¿®æ”¹çš„å¯è§æ€§ã€‚</p>
<pre><code>final Entry&lt;K,V&gt; nextEntry() {
    if (modCount != expectedModCount)
        throw new ConcurrentModificationException();
</code></pre><p>åœ¨ HashMap çš„ API ä¸­æŒ‡å‡ºï¼š</p>
<p>ç”±æ‰€æœ‰ HashMap ç±»çš„â€œcollection è§†å›¾æ–¹æ³•â€æ‰€è¿”å›çš„è¿­ä»£å™¨éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼šåœ¨è¿­ä»£å™¨åˆ›å»ºä¹‹åï¼Œå¦‚æœä»ç»“æ„ä¸Šå¯¹æ˜ å°„è¿›è¡Œä¿®æ”¹ï¼Œé™¤éé€šè¿‡è¿­ä»£å™¨æœ¬èº«çš„ remove æ–¹æ³•ï¼Œå…¶ä»–ä»»ä½•æ—¶é—´ä»»ä½•æ–¹å¼çš„ä¿®æ”¹ï¼Œè¿­ä»£å™¨éƒ½å°†æŠ›å‡º ConcurrentModificationExceptionã€‚å› æ­¤ï¼Œé¢å¯¹å¹¶å‘çš„ä¿®æ”¹ï¼Œè¿­ä»£å™¨å¾ˆå¿«å°±ä¼šå®Œå…¨å¤±è´¥ï¼Œè€Œä¸å†’åœ¨å°†æ¥ä¸ç¡®å®šçš„æ—¶é—´å‘ç”Ÿä»»æ„ä¸ç¡®å®šè¡Œä¸ºçš„é£é™©ã€‚</p>
<p>æ³¨æ„ï¼Œè¿­ä»£å™¨çš„å¿«é€Ÿå¤±è´¥è¡Œä¸ºä¸èƒ½å¾—åˆ°ä¿è¯ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå­˜åœ¨éåŒæ­¥çš„å¹¶å‘ä¿®æ”¹æ—¶ï¼Œä¸å¯èƒ½ä½œå‡ºä»»ä½•åšå†³çš„ä¿è¯ã€‚å¿«é€Ÿå¤±è´¥è¿­ä»£å™¨å°½æœ€å¤§åŠªåŠ›æŠ›å‡º ConcurrentModificationExceptionã€‚å› æ­¤ï¼Œç¼–å†™ä¾èµ–äºæ­¤å¼‚å¸¸çš„ç¨‹åºçš„åšæ³•æ˜¯é”™è¯¯çš„ï¼Œæ­£ç¡®åšæ³•æ˜¯ï¼šè¿­ä»£å™¨çš„å¿«é€Ÿå¤±è´¥è¡Œä¸ºåº”è¯¥ä»…ç”¨äºæ£€æµ‹ç¨‹åºé”™è¯¯ã€‚</p>
<h5 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h5><p>åœ¨ä¸Šæ–‡ä¸­ä¹Ÿæåˆ°ï¼Œfail-fast æœºåˆ¶ï¼Œæ˜¯ä¸€ç§é”™è¯¯æ£€æµ‹æœºåˆ¶ã€‚å®ƒåªèƒ½è¢«ç”¨æ¥æ£€æµ‹é”™è¯¯ï¼Œå› ä¸º JDK å¹¶ä¸ä¿è¯ fail-fast æœºåˆ¶ä¸€å®šä¼šå‘ç”Ÿã€‚è‹¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ fail-fast æœºåˆ¶çš„é›†åˆï¼Œå»ºè®®ä½¿ç”¨â€œjava.util.concurrent åŒ…ä¸‹çš„ç±»â€å»å–ä»£â€œjava.util åŒ…ä¸‹çš„ç±»â€ã€‚</p>
<h4 id="HashMap-çš„ä¸¤ç§éå†æ–¹å¼"><a href="#HashMap-çš„ä¸¤ç§éå†æ–¹å¼" class="headerlink" title="HashMap çš„ä¸¤ç§éå†æ–¹å¼"></a>HashMap çš„ä¸¤ç§éå†æ–¹å¼</h4><h5 id="ç¬¬ä¸€ç§"><a href="#ç¬¬ä¸€ç§" class="headerlink" title="ç¬¬ä¸€ç§"></a>ç¬¬ä¸€ç§</h5><pre><code>Map map = new HashMap();
Iterator iter = map.entrySet().iterator();
while (iter.hasNext()) {
    Map.Entry entry = (Map.Entry) iter.next();
    Object key = entry.getKey();
    Object val = entry.getValue();
}
</code></pre><p>æ•ˆç‡é«˜,ä»¥åä¸€å®šè¦ä½¿ç”¨æ­¤ç§æ–¹å¼ï¼</p>
<h5 id="ç¬¬äºŒç§"><a href="#ç¬¬äºŒç§" class="headerlink" title="ç¬¬äºŒç§"></a>ç¬¬äºŒç§</h5><pre><code>Map map = new HashMap();
Iterator iter = map.keySet().iterator();
while (iter.hasNext()) {
    Object key = iter.next();
    Object val = map.get(key);
}
</code></pre><p>æ•ˆç‡ä½,ä»¥åå°½é‡å°‘ä½¿ç”¨ï¼</p>
<h4 id="fast-failçš„HashIterator"><a href="#fast-failçš„HashIterator" class="headerlink" title="fast-failçš„HashIterator"></a>fast-failçš„HashIterator</h4><p>é›†åˆç±»ç”¨Iteratorç±»æ¥éå†å…¶åŒ…å«çš„å…ƒç´ ï¼Œæ¥å£Enumerationå·²ç»ä¸æ¨èä½¿ç”¨ã€‚ç›¸æ¯”Enumerationï¼ŒIteratoræœ‰ä¸‹é¢ä¸¤ä¸ªä¼˜åŠ¿ï¼š</p>
<pre><code>1.Iteratorå…è®¸è°ƒç”¨è€…åœ¨éå†é›†åˆç±»æ—¶åˆ é™¤é›†åˆç±»ä¸­åŒ…å«çš„å…ƒç´ ï¼ˆç›¸æ¯”Enumerationå¢åŠ äº†removeæ–¹æ³•ï¼‰
2.æ¯”Enumerationçš„å‘½åæ›´ç®€çŸ­HashMapä¸­æä¾›çš„ä¸‰ç§é›†åˆè§†è§’ï¼Œåº•å±‚éƒ½æ˜¯ç”¨HashIteratorå®ç°çš„ã€‚


private abstract class HashIterator&lt;E&gt; implements Iterator&lt;E&gt; {
    Entry&lt;K,V&gt; next;        // next entry to return
    //åœ¨åˆå§‹åŒ–Iteratorå®ä¾‹æ—¶ï¼Œçºªå½•ä¸‹å½“å‰çš„ä¿®æ”¹æ¬¡æ•°
    int expectedModCount;   // For fast-fail
    int index;              // current slot
    Entry&lt;K,V&gt; current;     // current entry
    HashIterator() {
        expectedModCount = modCount;
        if (size &gt; 0) { // advance to first entry
            Entry[] t = table;
            //éå†HashMapçš„tableï¼Œä¾æ¬¡æŸ¥æ‰¾å…ƒç´ 
            while (index &lt; t.length &amp;&amp; (next = t[index++]) == null)
                ;
        }
    }

    public final boolean hasNext() {
        return next != null;
    }

    final Entry&lt;K,V&gt; nextEntry() {
        //åœ¨è®¿é—®ä¸‹ä¸€ä¸ªEntryæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æœ‰å¯¹é›†åˆçš„ä¿®æ”¹
        //è¯´æ˜HashMapæ˜¯çº¿ç¨‹éå®‰å…¨çš„
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();
        Entry&lt;K,V&gt; e = next;
        if (e == null)
            throw new NoSuchElementException();
        if ((next = e.next) == null) {
            Entry[] t = table;
            while (index &lt; t.length &amp;&amp; (next = t[index++]) == null)
                ;
        }
        current = e;
        return e;
    }

    public void remove() {
        if (current == null)
            throw new IllegalStateException();
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();
        Object k = current.key;
        current = null;
        HashMap.this.removeEntryForKey(k);
        expectedModCount = modCount;
    }
}

private final class ValueIterator extends HashIterator&lt;V&gt; {
    public V next() {
           return nextEntry().value;
    }
}

private final class KeyIterator extends HashIterator&lt;K&gt; {
    public K next() {
        return nextEntry().getKey();
    }
}

private final class EntryIterator extends     HashIterator&lt;Map.Entry&lt;K,V&gt;&gt; {
    public Map.Entry&lt;K,V&gt; next() {
        return nextEntry();
    }
}
</code></pre><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>ä»‹ç»åˆ°è¿™é‡Œï¼ŒåŸºæœ¬ä¸Šç®—æ˜¯æŠŠHashMapä¸­ä¸€äº›æ ¸å¿ƒçš„ç‚¹è®²å®Œäº†ï¼Œä½†è¿˜æœ‰ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼šä¿å­˜Entryçš„tableæ•°ç»„ä¸ºtransientçš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿›è¡Œåºåˆ—åŒ–æ—¶ï¼Œå¹¶ä¸ä¼šåŒ…å«è¯¥æˆå‘˜ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p><code>transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;</code></p>
<p>ä¸ºäº†è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®ä¸‹é¢äº‹å®ï¼š</p>
<ul>
<li>Object.hashCodeæ–¹æ³•å¯¹äº<strong>ä¸€ä¸ªç±»çš„ä¸¤ä¸ªå®ä¾‹</strong>è¿”å›çš„æ˜¯ä¸åŒçš„å“ˆå¸Œå€¼</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥è¯•æƒ³ä¸‹é¢çš„åœºæ™¯ï¼š</p>
<blockquote>
<p>æˆ‘ä»¬åœ¨æœºå™¨Aä¸Šç®—å‡ºå¯¹è±¡Açš„å“ˆå¸Œå€¼ä¸ç´¢å¼•ï¼Œç„¶åæŠŠå®ƒæ’å…¥åˆ°HashMapä¸­ï¼Œç„¶åæŠŠè¯¥HashMapåºåˆ—åŒ–åï¼Œåœ¨æœºå™¨Bä¸Šé‡æ–°ç®—å¯¹è±¡çš„å“ˆå¸Œå€¼ä¸ç´¢å¼•ï¼Œè¿™ä¸æœºå™¨Aä¸Šç®—å‡ºçš„æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æœºå™¨Bä¸Šgetå¯¹è±¡Aæ—¶ï¼Œä¼šå¾—åˆ°é”™è¯¯çš„ç»“æœã€‚(å› ä¸ºæœºå™¨Açš„å¯¹è±¡Aä¸æœºå™¨Bçš„å¯¹è±¡Aæ˜¯ä¸€ä¸ªç±»çš„ä¸¤ä¸ªå®ä¾‹ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡æ¥çš„)</p>
<p>æ‰€ä»¥è¯´ï¼Œå½“åºåˆ—åŒ–ä¸€ä¸ªHashMapå¯¹è±¡æ—¶ï¼Œä¿å­˜Entryçš„tableæ˜¯ä¸éœ€è¦åºåˆ—åŒ–è¿›æ¥çš„ï¼Œå› ä¸ºå®ƒåœ¨å¦ä¸€å°æœºå™¨ä¸Šæ˜¯é”™è¯¯çš„ã€‚</p>
</blockquote>
<p>å› ä¸ºè¿™ä¸ªåŸå› ï¼ŒHashMapé‡ç°äº† <code>writeObject</code> ä¸ <code>readObject</code>  æ–¹æ³•<br>    private void writeObject(java.io.ObjectOutputStream s)<br>        throws IOException<br>    {<br>        // Write out the threshold, loadfactor, and any hidden stuff<br>        s.defaultWriteObject();</p>
<pre><code>    // Write out number of buckets
    if (table==EMPTY_TABLE) {
        s.writeInt(roundUpToPowerOf2(threshold));
    } else {
       s.writeInt(table.length);
    }

    // Write out size (number of Mappings)
    s.writeInt(size);

    // Write out keys and values (alternating)
    if (size &gt; 0) {
        for(Map.Entry&lt;K,V&gt; e : entrySet0()) {
            s.writeObject(e.getKey());
            s.writeObject(e.getValue());
        }
    }
}

private static final long serialVersionUID = 362498820763181265L;

private void readObject(java.io.ObjectInputStream s)
     throws IOException, ClassNotFoundException
{
    // Read in the threshold (ignored), loadfactor, and any hidden stuff
    s.defaultReadObject();
    if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) {
        throw new InvalidObjectException(&quot;Illegal load factor: &quot; +
                                           loadFactor);
    }

    // set other fields that need values
    table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;

    // Read in number of buckets
    s.readInt(); // ignored.

    // Read number of mappings
    int mappings = s.readInt();
    if (mappings &lt; 0)
        throw new InvalidObjectException(&quot;Illegal mappings count: &quot; +
                                           mappings);

    // capacity chosen by number of mappings and desired load (if &gt;= 0.25)
    int capacity = (int) Math.min(
                mappings * Math.min(1 / loadFactor, 4.0f),
                // we have limits...
                HashMap.MAXIMUM_CAPACITY);

    // allocate the bucket array;
    if (mappings &gt; 0) {
        inflateTable(capacity);
    } else {
        threshold = capacity;
    }

    init();  // Give subclass a chance to do its thing.

    // Read the keys and values, and put the mappings in the HashMap
    for (int i = 0; i &lt; mappings; i++) {
        K key = (K) s.readObject();
        V value = (V) s.readObject();
        putForCreate(key, value);
    }
}
private void putForCreate(K key, V value) {
    int hash = null == key ? 0 : hash(key);
    int i = indexFor(hash, table.length);

    /**
     * Look for preexisting entry for key.  This will never happen for
     * clone or deserialize.  It will only happen for construction if the
     * input Map is a sorted map whose ordering is inconsistent w/ equals.
     */
    for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) {
        Object k;
        if (e.hash == hash &amp;&amp;
            ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) {
            e.value = value;
            return;
        }
    }

    createEntry(hash, key, value, i);
}
</code></pre><p>ç®€å•æ¥è¯´ï¼Œåœ¨åºåˆ—åŒ–æ—¶ï¼Œé’ˆå¯¹Entryçš„keyä¸valueåˆ†åˆ«å•ç‹¬åºåˆ—åŒ–ï¼Œå½“ååºåˆ—åŒ–æ—¶ï¼Œå†å•ç‹¬å¤„ç†å³å¯ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥å›ç­”å¼€å§‹çš„å‡ ä¸ªé—®é¢˜ï¼ŒåŠ æ·±å¯¹HashMapçš„ç†è§£ï¼š</p>
<h4 id="1-ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a>1. ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h4><p>æ˜¯åŸºäºMapæ¥å£çš„å®ç°ï¼Œå­˜å‚¨é”®å€¼å¯¹æ—¶ï¼Œå®ƒå¯ä»¥æ¥æ”¶nullçš„é”®å€¼ï¼Œæ˜¯éåŒæ­¥çš„ï¼ŒHashMapå­˜å‚¨ç€Entry(hash, key, value, next)å¯¹è±¡ã€‚</p>
<h4 id="2-ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ"><a href="#2-ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ" class="headerlink" title="2. ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ"></a>2. ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ</h4><p>é€šè¿‡hashçš„æ–¹æ³•ï¼Œé€šè¿‡putå’Œgetå­˜å‚¨å’Œè·å–å¯¹è±¡ã€‚å­˜å‚¨å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†K/Vä¼ ç»™putæ–¹æ³•æ—¶ï¼Œå®ƒè°ƒç”¨hashCodeè®¡ç®—hashä»è€Œå¾—åˆ°bucketä½ç½®ï¼Œè¿›ä¸€æ­¥å­˜å‚¨ï¼ŒHashMapä¼šæ ¹æ®å½“å‰bucketçš„å ç”¨æƒ…å†µè‡ªåŠ¨è°ƒæ•´å®¹é‡(è¶…è¿‡Load Facotråˆ™resizeä¸ºåŸæ¥çš„2å€)ã€‚è·å–å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†Kä¼ ç»™getï¼Œå®ƒè°ƒç”¨hashCodeè®¡ç®—hashä»è€Œå¾—åˆ°bucketä½ç½®ï¼Œå¹¶è¿›ä¸€æ­¥è°ƒç”¨equals()æ–¹æ³•ç¡®å®šé”®å€¼å¯¹ã€‚å¦‚æœå‘ç”Ÿç¢°æ’çš„æ—¶å€™ï¼ŒHashmapé€šè¿‡é“¾è¡¨å°†äº§ç”Ÿç¢°æ’å†²çªçš„å…ƒç´ ç»„ç»‡èµ·æ¥ï¼Œåœ¨Java 8ä¸­ï¼Œå¦‚æœä¸€ä¸ªbucketä¸­ç¢°æ’å†²çªçš„å…ƒç´ è¶…è¿‡æŸä¸ªé™åˆ¶(é»˜è®¤æ˜¯8)ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘æ¥æ›¿æ¢é“¾è¡¨ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚</p>
<h4 id="3-ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals-å’ŒhashCode-çš„éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#3-ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals-å’ŒhashCode-çš„éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="3. ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals()å’ŒhashCode()çš„éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>3. ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals()å’ŒhashCode()çš„éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><p>é€šè¿‡å¯¹keyçš„hashCode()è¿›è¡Œhashingï¼Œå¹¶è®¡ç®—ä¸‹æ ‡( n-1 &amp; hash)ï¼Œä»è€Œè·å¾—bucketsçš„ä½ç½®ã€‚å¦‚æœäº§ç”Ÿç¢°æ’ï¼Œåˆ™åˆ©ç”¨key.equals()æ–¹æ³•å»é“¾è¡¨æˆ–æ ‘ä¸­å»æŸ¥æ‰¾å¯¹åº”çš„èŠ‚ç‚¹</p>
<h4 id="4-ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ"><a href="#4-ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ" class="headerlink" title="4.ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ"></a>4.ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ</h4><p>åœ¨Java 1.8çš„å®ç°ä¸­ï¼Œæ˜¯é€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š<code>(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥åœ¨bucketçš„næ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½bitéƒ½å‚ä¸åˆ°hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚</p>
<h4 id="5-å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­-load-factor-å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ"><a href="#5-å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­-load-factor-å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="5.å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­(load factor)å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ"></a>5.å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­(load factor)å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ</h4><p>å¦‚æœè¶…è¿‡äº†è´Ÿè½½å› å­(é»˜è®¤0.75)ï¼Œåˆ™ä¼šé‡æ–°resizeä¸€ä¸ªåŸæ¥é•¿åº¦ä¸¤å€çš„HashMapï¼Œå¹¶ä¸”é‡æ–°è°ƒç”¨hashæ–¹æ³•ã€‚</p>
<p>è½¬è½½è‡ªï¼š<br>Java HashMap æºç è§£æ <a href="http://liujiacai.net/blog/2015/09/03/java-hashmap/" target="_blank" rel="external">http://liujiacai.net/blog/2015/09/03/java-hashmap/</a></p>
<p>HashMap çš„å®ç°åŸç† <a href="http://wiki.jikexueyuan.com/project/java-collection/hashmap.html" target="_blank" rel="external">http://wiki.jikexueyuan.com/project/java-collection/hashmap.html</a></p>
<p>Java HashMapå·¥ä½œåŸç†åŠå®ç° <a href="http://yikun.github.io/2015/04/01/Java-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" target="_blank" rel="external">http://yikun.github.io/2015/04/01/Java-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/</a></p>
<p>ä¸€äº›å¥½æ–‡ç« ï¼š<br>HashMapçš„å·¥ä½œåŸç† <a href="http://www.importnew.com/7099.html" target="_blank" rel="external">http://www.importnew.com/7099.html</a><br>equals()å’ŒhashCode()çš„(åŒºåˆ«å‘¢ï¼Ÿ)åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬åœ¨HashMapä¸­çš„é‡è¦æ€§</p>
<h3 id="HashMapçš„å·¥ä½œåŸç†"><a href="#HashMapçš„å·¥ä½œåŸç†" class="headerlink" title="HashMapçš„å·¥ä½œåŸç†"></a>HashMapçš„å·¥ä½œåŸç†</h3><p>HashMapåŸºäºhashingåŸç†ï¼Œæˆ‘ä»¬é€šè¿‡put()å’Œget()æ–¹æ³•å‚¨å­˜å’Œè·å–å¯¹è±¡ã€‚å½“æˆ‘ä»¬å°†é”®å€¼å¯¹ä¼ é€’ç»™put()æ–¹æ³•æ—¶ï¼Œå®ƒè°ƒç”¨<strong>é”®å¯¹è±¡çš„hashCode()æ–¹æ³•</strong>æ¥è®¡ç®—hashcodeï¼Œè®©åæ‰¾åˆ°bucketä½ç½®æ¥å‚¨å­˜å€¼å¯¹è±¡ã€‚å½“è·å–å¯¹è±¡æ—¶ï¼Œé€šè¿‡<strong>é”®å¯¹è±¡çš„equals()æ–¹æ³•</strong>æ‰¾åˆ°æ­£ç¡®çš„é”®å€¼å¯¹ï¼Œç„¶åè¿”å›å€¼å¯¹è±¡ã€‚HashMapä½¿ç”¨é“¾è¡¨æ¥è§£å†³ç¢°æ’é—®é¢˜ï¼Œå½“å‘ç”Ÿç¢°æ’äº†ï¼Œå¯¹è±¡å°†ä¼šå‚¨å­˜åœ¨é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚ HashMapåœ¨æ¯ä¸ªé“¾è¡¨èŠ‚ç‚¹ä¸­å‚¨å­˜é”®å€¼å¯¹å¯¹è±¡ã€‚</p>
<p>å½“ä¸¤ä¸ªä¸åŒçš„é”®å¯¹è±¡çš„hashcodeç›¸åŒæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å®ƒä»¬ä¼šå‚¨å­˜åœ¨åŒä¸€ä¸ªbucketä½ç½®çš„é“¾è¡¨ä¸­ã€‚é”®å¯¹è±¡çš„equals()æ–¹æ³•ç”¨æ¥æ‰¾åˆ°é”®å€¼å¯¹ã€‚</p>
<p>å› ä¸ºHashMapçš„å¥½å¤„éå¸¸å¤šï¼Œæˆ‘æ›¾ç»åœ¨ç”µå­å•†åŠ¡çš„åº”ç”¨ä¸­ä½¿ç”¨HashMapä½œä¸ºç¼“å­˜ã€‚å› ä¸ºé‡‘èé¢†åŸŸéå¸¸å¤šçš„è¿ç”¨Javaï¼Œä¹Ÿå‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œæˆ‘ä»¬ä¼šç»å¸¸ç”¨åˆ°HashMapå’ŒConcurrentHashMapã€‚</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/æºç è§£æ/" rel="tag"># æºç è§£æ</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/16/Javaé›†åˆæ¡†æ¶ç»¼è¿°/" rel="next" title="Javaé›†åˆæ¡†æ¶ç»¼è¿°">
                <i class="fa fa-chevron-left"></i> Javaé›†åˆæ¡†æ¶ç»¼è¿°
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/03/16/Java-LinkedHashMapæºç è§£æ/" rel="prev" title="Java LinkedHashMapæºç è§£æ">
                Java LinkedHashMapæºç è§£æ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/03/16/Java-HashMapæºç è§£æ/"
           data-title="Java HashMapæºç è§£æ" data-url="https://brandon-winterfell.github.io/2017/03/16/Java-HashMapæºç è§£æ/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Brandon-Winterfell" />
          <p class="site-author-name" itemprop="name">Brandon-Winterfell</p>
           
              <p class="site-description motion-element" itemprop="description">é—²å¯‚å¤æ± æ—,é’è›™è·³è¿›æ°´ä¸­å¤®,æ‰‘é€šä¸€å£°å“</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#HashMap-æ¦‚è¿°"><span class="nav-number">1.</span> <span class="nav-text">HashMap æ¦‚è¿°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HashMap-çš„æ•°æ®ç»“æ„"><span class="nav-number">2.</span> <span class="nav-text">HashMap çš„æ•°æ®ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HashMapçš„ä¸€äº›ç‰¹ç‚¹"><span class="nav-number">3.</span> <span class="nav-text">HashMapçš„ä¸€äº›ç‰¹ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç­¾åï¼ˆsignatureï¼‰"><span class="nav-number">4.</span> <span class="nav-text">ç­¾åï¼ˆsignatureï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Cloneableæ¥å£"><span class="nav-number">4.1.</span> <span class="nav-text">Cloneableæ¥å£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mapæ¥å£"><span class="nav-number">4.2.</span> <span class="nav-text">Mapæ¥å£</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AbstractMapæŠ½è±¡ç±»"><span class="nav-number">4.3.</span> <span class="nav-text">AbstractMapæŠ½è±¡ç±»</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾è®¡ç†å¿µï¼ˆdesign-conceptï¼‰"><span class="nav-number">5.</span> <span class="nav-text">è®¾è®¡ç†å¿µï¼ˆdesign conceptï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å“ˆå¸Œè¡¨ï¼ˆhash-tableï¼‰"><span class="nav-number">5.1.</span> <span class="nav-text">å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ„é€ å‡½æ•°"><span class="nav-number">6.</span> <span class="nav-text">æ„é€ å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HashMap-çš„æ ¸å¿ƒæ–¹æ³•è§£è¯»"><span class="nav-number">7.</span> <span class="nav-text">HashMap çš„æ ¸å¿ƒæ–¹æ³•è§£è¯»</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å­˜å‚¨-putæ–¹æ³•-putæ“ä½œï¼ˆå«updateæ“ä½œï¼‰"><span class="nav-number">7.1.</span> <span class="nav-text">å­˜å‚¨ putæ–¹æ³• putæ“ä½œï¼ˆå«updateæ“ä½œï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è¯»å–-getæ–¹æ³•-getæ“ä½œ"><span class="nav-number">7.2.</span> <span class="nav-text">è¯»å– getæ–¹æ³• getæ“ä½œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#removeæ–¹æ³•-removeæ“ä½œ"><span class="nav-number">7.3.</span> <span class="nav-text">removeæ–¹æ³• removeæ“ä½œ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å½’çº³"><span class="nav-number">8.</span> <span class="nav-text">å½’çº³</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HashMap-çš„-resizeï¼ˆrehashï¼‰"><span class="nav-number">8.1.</span> <span class="nav-text">HashMap çš„ resizeï¼ˆrehashï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HashMap-çš„æ€§èƒ½å‚æ•°"><span class="nav-number">8.2.</span> <span class="nav-text">HashMap çš„æ€§èƒ½å‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fail-Fast-æœºåˆ¶"><span class="nav-number">8.3.</span> <span class="nav-text">Fail-Fast æœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#åŸç†"><span class="nav-number">8.3.1.</span> <span class="nav-text">åŸç†</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#è§£å†³æ–¹æ¡ˆ"><span class="nav-number">8.3.2.</span> <span class="nav-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HashMap-çš„ä¸¤ç§éå†æ–¹å¼"><span class="nav-number">8.4.</span> <span class="nav-text">HashMap çš„ä¸¤ç§éå†æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ç¬¬ä¸€ç§"><span class="nav-number">8.4.1.</span> <span class="nav-text">ç¬¬ä¸€ç§</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ç¬¬äºŒç§"><span class="nav-number">8.4.2.</span> <span class="nav-text">ç¬¬äºŒç§</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fast-failçš„HashIterator"><span class="nav-number">8.5.</span> <span class="nav-text">fast-failçš„HashIterator</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åºåˆ—åŒ–"><span class="nav-number">9.</span> <span class="nav-text">åºåˆ—åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">10.</span> <span class="nav-text">æ€»ç»“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><span class="nav-number">10.1.</span> <span class="nav-text">1. ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨HashMapï¼Ÿä»–æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ"><span class="nav-number">10.2.</span> <span class="nav-text">2. ä½ çŸ¥é“HashMapçš„å·¥ä½œåŸç†å—ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals-å’ŒhashCode-çš„éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><span class="nav-number">10.3.</span> <span class="nav-text">3. ä½ çŸ¥é“getå’Œputçš„åŸç†å—ï¼Ÿequals()å’ŒhashCode()çš„éƒ½æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ"><span class="nav-number">10.4.</span> <span class="nav-text">4.ä½ çŸ¥é“hashçš„å®ç°å—ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·å®ç°ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­-load-factor-å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ"><span class="nav-number">10.5.</span> <span class="nav-text">5.å¦‚æœHashMapçš„å¤§å°è¶…è¿‡äº†è´Ÿè½½å› å­(load factor)å®šä¹‰çš„å®¹é‡ï¼Œæ€ä¹ˆåŠï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HashMapçš„å·¥ä½œåŸç†"><span class="nav-number">11.</span> <span class="nav-text">HashMapçš„å·¥ä½œåŸç†</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Brandon-Winterfell</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"brandon-winterfell"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("k4OHabJDuJ13RNhNkrjU2hrQ-gzGzoHsz", "saH320A6yTLKdnLkDjp9TOta");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
